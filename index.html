<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE COLOSSEUM - ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø´ÙØ±Ø§Øª</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Georgia', serif; background: linear-gradient(135deg, #0a0e27, #1a1a3e); color: #fff; direction: rtl; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { font-size: 3em; color: #d4af37; letter-spacing: 3px; }
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .login-box { background: rgba(212, 175, 55, 0.1); border: 3px solid #d4af37; padding: 50px; border-radius: 10px; max-width: 500px; margin: 50px auto; text-align: center; }
        .login-box h2 { color: #d4af37; margin-bottom: 30px; font-size: 2em; }
        .login-box input { width: 100%; padding: 15px; margin-bottom: 20px; border: 2px solid #d4af37; border-radius: 5px; background: rgba(255, 255, 255, 0.05); color: inherit; text-align: center; }
        .login-box button { width: 100%; padding: 15px; background: #d4af37; color: #000; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        .login-box button:hover { background: #ffd700; }
        .teams-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .team-card { background: rgba(212, 175, 55, 0.1); border: 2px solid #d4af37; padding: 25px; border-radius: 10px; text-align: center; }
        .team-card h3 { color: #d4af37; margin-bottom: 15px; }
        .team-card.selected { border-color: #ffd700; background: rgba(212, 175, 55, 0.3); }
        .team-btn { background: #d4af37; color: #000; border: none; padding: 10px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 10px; font-weight: bold; }
        .team-btn:hover { background: #ffd700; }
        .team-btn.danger { background: #ff6b6b; color: white; }
        .start-btn { width: 100%; padding: 20px; background: #d4af37; color: #000; border: none; border-radius: 5px; font-size: 1.3em; font-weight: bold; cursor: pointer; margin-top: 30px; display: none; }
        .start-btn.show { display: block; }
        .code-container { background: rgba(212, 175, 55, 0.1); border: 3px solid #d4af37; padding: 50px; border-radius: 10px; max-width: 600px; margin: 50px auto; text-align: center; }
        .code-container h2 { color: #d4af37; font-size: 2em; margin-bottom: 30px; }
        .timer { background: rgba(212, 175, 55, 0.2); padding: 15px; margin: 20px 0; border-radius: 5px; font-size: 1.5em; font-family: monospace; color: #d4af37; }
        .code-input { width: 100%; padding: 15px; margin: 20px 0; border: 2px solid #d4af37; border-radius: 5px; background: rgba(255, 255, 255, 0.05); color: #d4af37; text-align: center; text-transform: uppercase; font-size: 1.2em; }
        .message { margin-top: 20px; min-height: 30px; font-weight: bold; }
        .message.success { color: #4CAF50; }
        .message.error { color: #ff6b6b; }
        .images-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .image-box { width: 100%; height: 250px; border: 2px solid #d4af37; border-radius: 5px; overflow: hidden; }
        .image-box img { width: 100%; height: 100%; object-fit: cover; }
        .back-btn { width: 100%; padding: 15px; background: #d4af37; color: #000; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .stats-table { width: 100%; color: #d4af37; border-collapse: collapse; margin-top: 20px; }
        .stats-table th, .stats-table td { padding: 10px; border-bottom: 1px solid #666; text-align: center; }
        .stats-table th { border-bottom: 2px solid #d4af37; }
        h2 { text-align: center; color: #d4af37; margin-bottom: 30px; font-size: 2em; }
        .timer-warning { color: #ff6b6b; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ” THE COLOSSEUM</h1>
    </div>

    <div class="container">
        <!-- Login -->
        <div class="screen active" id="login">
            <div class="login-box">
                <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                <input type="text" id="nameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
                <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
                <button onclick="showAdmin()" style="background: #888;">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
            </div>
        </div>

        <!-- Admin Login -->
        <div class="screen" id="adminLogin">
            <div class="login-box">
                <h2>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
                <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                <button onclick="checkAdmin()">Ø¯Ø®ÙˆÙ„</button>
                <button onclick="logout()" style="background: #888;">Ø¹ÙˆØ¯Ø©</button>
            </div>
        </div>

        <!-- Teams -->
        <div class="screen" id="teams">
            <h2>Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚Ùƒ</h2>
            <div class="timer" id="timerDisplay" style="display:none;">â±ï¸ <span id="timeLeft">02:00:00</span></div>
            <div class="teams-grid" id="teamsContainer"></div>
            <button class="start-btn" id="startBtn" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚</button>
        </div>

        <!-- Code -->
        <div class="screen" id="code">
            <div class="code-container">
                <h2 id="teamTitle">Ø§Ù„ÙØ±ÙŠÙ‚</h2>
                <div class="timer">â±ï¸ <span id="codeTime">02:00:00</span></div>
                <input type="text" id="codeInput" class="code-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø´ÙØ±Ø©" onkeypress="if(event.key==='Enter') verify()">
                <button onclick="verify()" style="width: 100%; padding: 15px; background: #d4af37; color: #000; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">ØªØ­Ù‚Ù‚</button>
                <div class="message" id="msg"></div>
            </div>
        </div>

        <!-- Images -->
        <div class="screen" id="images">
            <h2>Ù…Ù„ÙØ§Øª Ø§Ù„Ù‚Ø¶ÙŠØ©</h2>
            <div style="margin: 20px 0; text-align: center;">
                <button onclick="downloadAllImages()" style="padding: 12px 30px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin: 5px;">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ±</button>
                <button onclick="copyAllImageUrls()" style="padding: 12px 30px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin: 5px;">ğŸ“‹ Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
            </div>
            <div class="images-grid" id="imagesContainer"></div>
            <button class="back-btn" onclick="backTeams()">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>

        <!-- Admin -->
        <div class="screen" id="admin">
            <div class="login-box">
                <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
                <button class="team-btn" onclick="showStats()">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                <button class="team-btn" onclick="toggleGameTimer()">Ø¨Ø¯Ø¡/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª</button>
                <button class="team-btn danger" onclick="resetGame()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                <button class="team-btn" style="background: #888;" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
                <div id="statsContainer"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        const { createClient } = supabase;
        const supabaseClient = createClient('https://uidjszsqwuccjyzsatdk.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVpZGpzenNxd3VjY2p5enNhdGRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4MDQwMzcsImV4cCI6MjA4NTM4MDAzN30.AGGAiOtEas-aW2rYSuzTCT3KbwkWrhCi9xA5AyrYxaM');

        // ØªÙ… Ø¥Ø¶Ø§ÙØ© 11 ÙØ±ÙŠÙ‚ Ù…Ø¹ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        const CODES = [
            'POWER', 'WISDOM', 'VALOR', 'PATIENCE', 'PROMTITUDE', 
            'FAITH', 'HONESTY', 'JUSTICE', 'INTEGRITY', 'LOYALTY', 'CONFIDENCE'
        ];

        const TEAM_NAMES = [
            'Maximus',
            'Aurelius',
            'Cassius',
            'Tiberius',
            'Lucius',
            'Valerius',
            'Septimus',
            'Magnus',
            'Decimus',
            'Dominus',
            'Ashur'
        ];

        const IMAGES = [
            'https://i.imgur.com/mG1EsgX.jpg', 'https://i.imgur.com/BgxLUmr.jpg', 
            'https://i.imgur.com/shFAoGJ.jpg', 'https://i.imgur.com/9nQC9ay.jpg', 
            'https://i.imgur.com/X9vtn6w.jpg', 'https://i.imgur.com/23dKeLP.jpg', 
            'https://i.imgur.com/rICqT3D.jpg', 'https://i.imgur.com/3OAJguF.jpg', 
            'https://i.imgur.com/B3tnfms.jpg'
        ];

        // Ø¥Ù†Ø´Ø§Ø¡ 11 ÙØ±ÙŠÙ‚ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 9
        const teams = Array(11).fill(0).map((_, i) => ({
            id: i + 1, 
            number: i + 1, 
            members: [], 
            leader: null, 
            solved: false, 
            attempts: 0
        }));

        let currentUser = null;
        let currentTeam = null;
        let gameStarted = false;
        let timeRemaining = 7200; // Ø³Ø§Ø¹ØªØ§Ù†
        let timerInterval = null;

        function show(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        async function login() {
            const name = document.getElementById('nameInput').value.trim();
            if (!name) { alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ'); return; }
            currentUser = name;
            await loadData();
            show('teams');
            renderTeams();
        }

        function showAdmin() {
            show('adminLogin');
        }

        function checkAdmin() {
            if (document.getElementById('adminPass').value === 'admin123') {
                show('admin');
            } else {
                alert('Ø®Ø·Ø£ ÙÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
            }
        }

        function logout() {
            currentUser = null;
            currentTeam = null;
            document.getElementById('nameInput').value = '';
            document.getElementById('adminPass').value = '';
            if (timerInterval) clearInterval(timerInterval);
            show('login');
        }

        async function loadData() {
            try {
                const { data, error } = await supabaseClient.from('game_state').select('*').eq('id', 1);
                
                if (error) {
                    console.log('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø§Ø¨Ù‚Ø©ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...');
                    subscribe();
                    return;
                }

                if (data && data.length > 0) {
                    const gameData = data[0];
                    gameStarted = gameData.started || false;
                    timeRemaining = gameData.time_remaining || 7200;
                    
                    if (gameData.teams && Array.isArray(gameData.teams)) {
                        gameData.teams.forEach(t => {
                            const team = teams.find(x => x.id === t.id);
                            if (team) Object.assign(team, t);
                        });
                    }

                    if (gameStarted && !timerInterval) {
                        startTimerInterval();
                    }
                }

                subscribe();
            } catch (err) {
                console.log('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©');
                subscribe();
            }
        }

        function subscribe() {
            supabaseClient
                .channel('updates')
                .on('postgres_changes', {event: '*', schema: 'public', table: 'game_state'}, (p) => {
                    if (p.new) {
                        gameStarted = p.new.started || gameStarted;
                        timeRemaining = p.new.time_remaining || timeRemaining;
                        
                        if (p.new.teams && Array.isArray(p.new.teams)) {
                            p.new.teams.forEach(t => {
                                const team = teams.find(x => x.id === t.id);
                                if (team) Object.assign(team, t);
                            });
                        }

                        updateTimerDisplay();

                        if (document.getElementById('teams').classList.contains('active')) {
                            renderTeams();
                        }
                    }
                })
                .subscribe((status) => {
                    console.log('Realtime status:', status);
                });
        }

        async function save() {
            try {
                const gameData = {
                    started: gameStarted,
                    time_remaining: timeRemaining,
                    teams: teams.map(t => ({
                        id: t.id,
                        number: t.number,
                        members: t.members,
                        leader: t.leader,
                        solved: t.solved,
                        attempts: t.attempts
                    }))
                };

                const { data: existingData } = await supabaseClient
                    .from('game_state')
                    .select('id')
                    .eq('id', 1);

                if (existingData && existingData.length > 0) {
                    await supabaseClient
                        .from('game_state')
                        .update(gameData)
                        .eq('id', 1);
                } else {
                    await supabaseClient
                        .from('game_state')
                        .insert([{ id: 1, ...gameData }]);
                }
            } catch (err) {
                console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹');
            }
        }

        function renderTeams() {
            let html = '';
            teams.forEach(t => {
                const isMember = t.members.includes(currentUser);
                const isFull = t.members.length >= 4 && !isMember;
                const teamName = TEAM_NAMES[t.id - 1];
                html += `<div class="team-card ${currentTeam?.id === t.id ? 'selected' : ''}">
                    <h3>${teamName}</h3>
                    <p>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: ${t.members.length}/4</p>
                    ${t.members.length > 0 ? `<p style="color: #ffd700; font-size: 0.9em;">ğŸ‘¥ ${t.members.join(', ')}</p>` : '<p style="color: #4CAF50;">âœ… Ù…ØªØ§Ø­</p>'}
                    ${t.solved ? `<p style="color: #4CAF50; font-weight: bold;">âœ… ØªÙ… Ø­Ù„Ù‡</p>` : ''}
                    ${!isFull && !isMember ? `<button class="team-btn" onclick="selectTeam(${t.id})">Ø§Ø®ØªØ±</button>` : ''}
                    ${isMember ? `<button class="team-btn danger" onclick="leaveTeam(${t.id})">ØºØ§Ø¯Ø±</button>` : ''}
                </div>`;
            });
            document.getElementById('teamsContainer').innerHTML = html;
        }

        function selectTeam(id) {
            const t = teams.find(x => x.id === id);
            if (t.members.length >= 4) { alert('Ø§Ù„ÙØ±ÙŠÙ‚ Ù…Ù…ØªÙ„Ø¦'); return; }
            if (!t.members.includes(currentUser)) {
                t.members.push(currentUser);
                if (!t.leader) t.leader = currentUser;
                save();
            }
            currentTeam = t;
            document.getElementById('startBtn').classList.add('show');
            renderTeams();
        }

        function leaveTeam(id) {
            const t = teams.find(x => x.id === id);
            t.members = t.members.filter(m => m !== currentUser);
            if (t.leader === currentUser && t.members.length > 0) t.leader = t.members[0];
            else if (t.members.length === 0) t.leader = null;
            save();
            if (currentTeam?.id === id) { 
                currentTeam = null; 
                document.getElementById('startBtn').classList.remove('show'); 
            }
            renderTeams();
        }

        function startGame() {
            if (!currentTeam) { alert('Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚ Ø£ÙˆÙ„Ø§Ù‹'); return; }
            
            if (!gameStarted) { 
                gameStarted = true;
                timeRemaining = 7200;
                save();
                startTimerInterval();
                document.getElementById('timerDisplay').style.display = 'block';
            }
            
            const teamName = TEAM_NAMES[currentTeam.id - 1];
            document.getElementById('teamTitle').textContent = `ÙØ±ÙŠÙ‚ ${teamName}`;
            show('code');
            document.getElementById('codeInput').focus();
            updateTimerDisplay();
        }

        function startTimerInterval() {
            // ØªÙ†Ø¸ÙŠÙ Ø£ÙŠ Ù…Ø¤Ù‚Øª Ø³Ø§Ø¨Ù‚
            if (timerInterval) clearInterval(timerInterval);

            timerInterval = setInterval(() => {
                if (gameStarted && timeRemaining > 0) {
                    timeRemaining--;
                    updateTimerDisplay();

                    // Ø­ÙØ¸ ÙƒÙ„ 5 Ø«ÙˆØ§Ù† Ù„ØªÙ‚Ù„ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù€ API
                    if (timeRemaining % 5 === 0) {
                        save();
                    }

                    if (timeRemaining === 300) {
                        alert('âš ï¸ ØªØ­Ø°ÙŠØ±: 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…ØªØ¨Ù‚ÙŠØ©!');
                    }

                    if (timeRemaining <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        gameStarted = false;
                        save();
                        alert('â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!');
                        endGame();
                    }
                }
            }, 1000);
        }

        function toggleGameTimer() {
            gameStarted = !gameStarted;
            if (gameStarted) {
                startTimerInterval();
                alert('âœ… ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª');
            } else {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                alert('â¸ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª');
            }
            save();
        }

        function updateTimerDisplay() {
            const h = Math.floor(timeRemaining / 3600);
            const m = Math.floor((timeRemaining % 3600) / 60);
            const s = timeRemaining % 60;
            const t = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
            
            document.getElementById('timeLeft').textContent = t;
            document.getElementById('codeTime').textContent = t;

            // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨ Ù…Ù† Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
            const timerElements = document.querySelectorAll('.timer');
            timerElements.forEach(el => {
                if (timeRemaining <= 300) {
                    el.classList.add('timer-warning');
                } else {
                    el.classList.remove('timer-warning');
                }
            });
        }

        function verify() {
            const input = document.getElementById('codeInput').value.trim().toUpperCase();
            if (!currentTeam || !input) { alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø´ÙØ±Ø©'); return; }
            
            const correct = CODES[currentTeam.id - 1];
            const msg = document.getElementById('msg');
            
            if (input === correct) {
                msg.textContent = 'âœ… ØµØ­ÙŠØ­!';
                msg.className = 'message success';
                currentTeam.solved = true;
                timeRemaining = Math.max(0, timeRemaining - 900);
                save();
                
                setTimeout(() => { 
                    let html = '';
                    IMAGES.forEach((img, idx) => html += `<div class="image-box"><img src="${img}" alt="ØµÙˆØ±Ø©"></div>`);
                    document.getElementById('imagesContainer').innerHTML = html;
                    show('images');
                }, 1500);
            } else {
                currentTeam.attempts++;
                msg.innerHTML = `âŒ Ø®Ø·Ø£!<br>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: ${currentTeam.attempts}`;
                msg.className = 'message error';
                document.getElementById('codeInput').value = '';
                save();
            }
        }

        function downloadAllImages() {
            const zip = new JSZip();
            let loadedCount = 0;

            IMAGES.forEach((url, idx) => {
                fetch(url)
                    .then(res => res.blob())
                    .then(blob => {
                        zip.file(`ØµÙˆØ±Ø©_${idx + 1}.jpg`, blob);
                        loadedCount++;
                        if (loadedCount === IMAGES.length) {
                            zip.generateAsync({type: 'blob'})
                                .then(content => {
                                    const link = document.createElement('a');
                                    link.href = URL.createObjectURL(content);
                                    link.download = 'Ù…Ù„ÙØ§Øª_Ø§Ù„Ù‚Ø¶ÙŠØ©.zip';
                                    link.click();
                                    alert('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ±!');
                                });
                        }
                    })
                    .catch(() => {
                        loadedCount++;
                        if (loadedCount === IMAGES.length) {
                            alert('âš ï¸ Ø¨Ø¹Ø¶ Ø§Ù„ØµÙˆØ± Ù„Ù… ØªÙØ­Ù…Ù‘Ù„ Ø¨Ù†Ø¬Ø§Ø­');
                        }
                    });
            });
        }

        function copyAllImageUrls() {
            const urls = IMAGES.join('\n');
            navigator.clipboard.writeText(urls).then(() => {
                alert('âœ… ØªÙ… Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·!');
            }).catch(() => {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®ØŒ Ø­Ø§ÙˆÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹');
            });
        }

        function backTeams() {
            show('teams');
        }

        function endGame() {
            gameStarted = false;
            timeRemaining = 7200;
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = null;
            save();
            show('teams');
        }

        function showStats() {
            let html = '<table class="stats-table"><tr><th>Ø§Ù„ÙØ±ÙŠÙ‚</th><th>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</th></tr>';
            teams.forEach(t => {
                const teamName = TEAM_NAMES[t.id - 1];
                html += `<tr><td>${teamName}</td><td>${t.members.length}/4</td><td>${t.solved ? 'âœ… ØªÙ…' : 'âŒ Ù„Ù… ÙŠØªÙ…'}</td><td>${t.attempts}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('statsContainer').innerHTML = html;
        }

        function resetGame() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) {
                teams.forEach(t => { 
                    t.members = []; 
                    t.leader = null; 
                    t.solved = false; 
                    t.attempts = 0; 
                });
                gameStarted = false;
                timeRemaining = 7200;
                if (timerInterval) clearInterval(timerInterval);
                timerInterval = null;
                save();
                alert('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­');
                logout();
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', () => {
            console.log('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
            loadData();
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', () => {
            save();
        });
    </script>
</body>
</html>
